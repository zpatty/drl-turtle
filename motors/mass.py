#!/usr/bin/env python
# -*- coding: utf-8 -*-
import numpy as np
from math import sqrt, sin, cos
from scipy.linalg import block_diag
def mass(q, dq):

    q1 = q[0][0] - np.pi
    q2 = q[1][0] - np.pi
    q3 = q[2][0] - np.pi

    q4 = q[3][0] - np.pi
    q5 = q[4][0] - np.pi
    q6 = q[5][0] - np.pi


    dq1 = q[0][0]
    dq2 = q[1][0]
    dq3 = q[2][0]

    dq4 = q[3][0]
    dq5 = q[4][0]
    dq6 = q[5][0]

    gr = 9.81
    m = 0.2
    l = 0.065
    w = 0.044
    h = 0.034
    lf = 0.19
    wf = 0.09
    hf = 0.025
    lm = 0.06
    m1 = m
    m2 = m
    m3 = m
    m4 = 0.5
    I11 = 1/12*m*(l**2 + h**2)
    I12 = 1/12*m*(w**2 + h**2)
    I13 = 1/12*m*(w**2 + l**2)
    I21 = 1/12*m*(w**2 + h**2)
    I22 = 1/12*m*(w**2 + l**2)
    I23 = 1/12*m*(h**2 + l**2)
    I31 = 1/12*m*(h**2 + w**2)
    I32 = 1/12*m*(h**2 + l**2)
    I33 = 1/12*m*(w**2 + l**2)
    I41 = 1/12*m*(lf**2 + hf**2)
    I42 = 1/12*m*(wf**2 + hf**2)
    I43 = 1/12*m*(wf**2 + lf**2)
    l1 = 0.06
    l2 = 0.065
    lo1 = lm/2 - 0.015
    lo2 = lm/2 - 0.015
    lo3 = 0.025
    lo4 = lm/2 - 0.015
    
    M1 = np.array([[I21 + I32 + I42 + l2**2*m2 + l2**2*m3 + l2**2*m4 + (lf**2*m4)/4 + lo2**2*m3 + lo2**2*m4 + lo3**2*m3 + lo3**2*m4 + lo4**2*m4 + I31*cos(q2)**2 - I32*cos(q2)**2 - I42*cos(q2)**2 + I43*cos(q2)**2 + I41*cos(q2)**2*cos(q3)**2 - I43*cos(q2)**2*cos(q3)**2 + 2*lo2*lo4*m4 - lo2**2*m3*cos(q2)**2 - lo2**2*m4*cos(q2)**2 - lo4**2*m4*cos(q2)**2 + (m4*wf**2*cos(q2)**2)/4 - (lf**2*m4*cos(q2)**2*cos(q3)**2)/4 + lf*lo2*m4*cos(q3) + lf*lo4*m4*cos(q3) + l2*m4*wf*cos(q2) + 2*l2*lo2*m3*sin(q2) + 2*l2*lo2*m4*sin(q2) + 2*l2*lo4*m4*sin(q2) - lf*lo3*m4*sin(q3) - 2*lo2*lo4*m4*cos(q2)**2 + (lo2*m4*wf*sin(2*q2))/2 + (lo4*m4*wf*sin(2*q2))/2 + l2*lf*m4*cos(q3)*sin(q2) - lf*lo2*m4*cos(q2)**2*cos(q3) - lf*lo4*m4*cos(q2)**2*cos(q3) + (lf*m4*wf*cos(q2)*cos(q3)*sin(q2))/2, (I41*sin(2*q3)*cos(q2))/2 - (I43*sin(2*q3)*cos(q2))/2 + lo2*lo3*m3*cos(q2) + lo2*lo3*m4*cos(q2) + lo3*lo4*m4*cos(q2) - (lo3*m4*wf*sin(q2))/2 - (lf**2*m4*sin(2*q3)*cos(q2))/8 + (lf*lo3*m4*cos(q2)*cos(q3))/2 - (lf*lo2*m4*cos(q2)*sin(q3))/2 - (lf*lo4*m4*cos(q2)*sin(q3))/2 + (lf*m4*wf*sin(q2)*sin(q3))/4, I42*sin(q2) + (lf**2*m4*sin(q2))/4 + (l2*lf*m4*cos(q3))/2 + (lf*m4*wf*cos(q2)*cos(q3))/4 + (lf*lo2*m4*cos(q3)*sin(q2))/2 + (lf*lo4*m4*cos(q3)*sin(q2))/2 - (lf*lo3*m4*sin(q2)*sin(q3))/2],
[                                                                                                                                                                                                                                                                                                                                                                                                                               (I41*sin(2*q3)*cos(q2))/2 - (I43*sin(2*q3)*cos(q2))/2 + lo2*lo3*m3*cos(q2) + lo2*lo3*m4*cos(q2) + lo3*lo4*m4*cos(q2) - (lo3*m4*wf*sin(q2))/2 - (lf**2*m4*sin(2*q3)*cos(q2))/8 + (lf*lo3*m4*cos(q2)*cos(q3))/2 - (lf*lo2*m4*cos(q2)*sin(q3))/2 - (lf*lo4*m4*cos(q2)*sin(q3))/2 + (lf*m4*wf*sin(q2)*sin(q3))/4,                                                                                                                                     I33 + I41 + lo2**2*m3 + lo2**2*m4 + lo4**2*m4 + (m4*wf**2)/4 - I41*cos(q3)**2 + I43*cos(q3)**2 + 2*lo2*lo4*m4 + (lf**2*m4*cos(q3)**2)/4 + lf*lo2*m4*cos(q3) + lf*lo4*m4*cos(q3),                                                                                                                                                                    (lf*m4*wf*sin(q3))/4],
[                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   I42*sin(q2) + (lf**2*m4*sin(q2))/4 + (l2*lf*m4*cos(q3))/2 + (lf*m4*wf*cos(q2)*cos(q3))/4 + (lf*lo2*m4*cos(q3)*sin(q2))/2 + (lf*lo4*m4*cos(q3)*sin(q2))/2 - (lf*lo3*m4*sin(q2)*sin(q3))/2,                                                                                                                                                                                                                                                                                        (lf*m4*wf*sin(q3))/4,                                                                                                                                                                       (m4*lf**2)/4 + I42]])
    
    
    C1 = np.array([[dq2*(I32*sin(2*q2) - I31*sin(2*q2) + I42*sin(2*q2) - I43*sin(2*q2) + lo2**2*m3*sin(2*q2) + lo2**2*m4*sin(2*q2) + lo4**2*m4*sin(2*q2) - (m4*wf**2*sin(2*q2))/4 + 2*l2*lo2*m3*cos(q2) + 2*l2*lo2*m4*cos(q2) + 2*l2*lo4*m4*cos(q2) - l2*m4*wf*sin(q2) - 2*I41*cos(q2)*cos(q3)**2*sin(q2) + 2*I43*cos(q2)*cos(q3)**2*sin(q2) + lo2*m4*wf*cos(2*q2) + lo4*m4*wf*cos(2*q2) + 2*lo2*lo4*m4*sin(2*q2) + l2*lf*m4*cos(q2)*cos(q3) + (lf**2*m4*cos(q2)*cos(q3)**2*sin(q2))/2 + (lf*m4*wf*cos(q2)**2*cos(q3))/2 - (lf*m4*wf*cos(q3)*sin(q2)**2)/2 + 2*lf*lo2*m4*cos(q2)*cos(q3)*sin(q2) + 2*lf*lo4*m4*cos(q2)*cos(q3)*sin(q2)) - dq3*(lf*lo3*m4*cos(q3) + lf*lo2*m4*sin(q3) + lf*lo4*m4*sin(q3) + 2*I41*cos(q2)**2*cos(q3)*sin(q3) - 2*I43*cos(q2)**2*cos(q3)*sin(q3) + l2*lf*m4*sin(q2)*sin(q3) - (lf**2*m4*cos(q2)**2*cos(q3)*sin(q3))/2 - lf*lo2*m4*cos(q2)**2*sin(q3) - lf*lo4*m4*cos(q2)**2*sin(q3) + (lf*m4*wf*cos(q2)*sin(q2)*sin(q3))/2), I32*dq1*sin(2*q2) - I31*dq1*sin(2*q2) + I42*dq1*sin(2*q2) - I43*dq1*sin(2*q2) + I42*dq3*cos(q2) + I41*dq3*cos(2*q3)*cos(q2) - I43*dq3*cos(2*q3)*cos(q2) - I41*dq2*sin(2*q3)*sin(q2) + I43*dq2*sin(2*q3)*sin(q2) + dq1*lo2**2*m3*sin(2*q2) + dq1*lo2**2*m4*sin(2*q2) + dq1*lo4**2*m4*sin(2*q2) - (dq1*m4*wf**2*sin(2*q2))/4 + (dq3*lf**2*m4*cos(q2))/4 - (dq3*lf**2*m4*cos(2*q3)*cos(q2))/4 + (dq2*lf**2*m4*sin(2*q3)*sin(q2))/4 + dq1*lo2*m4*wf*cos(2*q2) + dq1*lo4*m4*wf*cos(2*q2) + 2*dq1*lo2*lo4*m4*sin(2*q2) + 2*dq1*l2*lo2*m3*cos(q2) + 2*dq1*l2*lo2*m4*cos(q2) + 2*dq1*l2*lo4*m4*cos(q2) - dq2*lo3*m4*wf*cos(q2) - 2*dq2*lo2*lo3*m3*sin(q2) - 2*dq2*lo2*lo3*m4*sin(q2) - 2*dq2*lo3*lo4*m4*sin(q2) - dq1*l2*m4*wf*sin(q2) - 2*I41*dq1*cos(q2)*cos(q3)**2*sin(q2) + 2*I43*dq1*cos(q2)*cos(q3)**2*sin(q2) + (dq1*lf*m4*wf*cos(q2)**2*cos(q3))/2 - (dq1*lf*m4*wf*cos(q3)*sin(q2)**2)/2 + dq1*l2*lf*m4*cos(q2)*cos(q3) - dq2*lf*lo3*m4*cos(q3)*sin(q2) - dq3*lf*lo3*m4*cos(q2)*sin(q3) + (dq2*lf*m4*wf*cos(q2)*sin(q3))/2 + dq2*lf*lo2*m4*sin(q2)*sin(q3) + dq2*lf*lo4*m4*sin(q2)*sin(q3) + (dq1*lf**2*m4*cos(q2)*cos(q3)**2*sin(q2))/2 + 2*dq1*lf*lo2*m4*cos(q2)*cos(q3)*sin(q2) + 2*dq1*lf*lo4*m4*cos(q2)*cos(q3)*sin(q2), (dq2*cos(q2)*(2*I41 + 2*I42 - 2*I43 - 4*I41*sin(q3)**2 + 4*I43*sin(q3)**2 + lf**2*m4*sin(q3)**2 - 2*lf*lo3*m4*sin(q3)))/2 - dq1*(lf*lo3*m4*cos(q3) + lf*lo2*m4*sin(q3) + lf*lo4*m4*sin(q3) + 2*I41*cos(q2)**2*cos(q3)*sin(q3) - 2*I43*cos(q2)**2*cos(q3)*sin(q3) + l2*lf*m4*sin(q2)*sin(q3) - (lf**2*m4*cos(q2)**2*cos(q3)*sin(q3))/2 - lf*lo2*m4*cos(q2)**2*sin(q3) - lf*lo4*m4*cos(q2)**2*sin(q3) + (lf*m4*wf*cos(q2)*sin(q2)*sin(q3))/2) - (dq3*lf*m4*(2*l2*sin(q3) + 2*lo3*cos(q3)*sin(q2) + wf*cos(q2)*sin(q3) + 2*lo2*sin(q2)*sin(q3) + 2*lo4*sin(q2)*sin(q3)))/2],
[                                                                         - (dq3*(2*I41*cos(q2) + 2*I42*cos(q2) - 2*I43*cos(q2) - 4*I41*cos(q2)*cos(q3)**2 + 4*I43*cos(q2)*cos(q3)**2 + lf**2*m4*cos(q2)*cos(q3)**2 + 2*lf*lo2*m4*cos(q2)*cos(q3) + 2*lf*lo4*m4*cos(q2)*cos(q3) - lf*m4*wf*cos(q3)*sin(q2)))/2 - dq1*(I32*sin(2*q2) - I31*sin(2*q2) + I42*sin(2*q2) - I43*sin(2*q2) + lo2**2*m3*sin(2*q2) + lo2**2*m4*sin(2*q2) + lo4**2*m4*sin(2*q2) - (m4*wf**2*sin(2*q2))/4 + 2*l2*lo2*m3*cos(q2) + 2*l2*lo2*m4*cos(q2) + 2*l2*lo4*m4*cos(q2) - l2*m4*wf*sin(q2) - 2*I41*cos(q2)*cos(q3)**2*sin(q2) + 2*I43*cos(q2)*cos(q3)**2*sin(q2) + lo2*m4*wf*cos(2*q2) + lo4*m4*wf*cos(2*q2) + 2*lo2*lo4*m4*sin(2*q2) + l2*lf*m4*cos(q2)*cos(q3) + (lf**2*m4*cos(q2)*cos(q3)**2*sin(q2))/2 + (lf*m4*wf*cos(q2)**2*cos(q3))/2 - (lf*m4*wf*cos(q3)*sin(q2)**2)/2 + 2*lf*lo2*m4*cos(q2)*cos(q3)*sin(q2) + 2*lf*lo4*m4*cos(q2)*cos(q3)*sin(q2)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            -dq3*(I43*sin(2*q3) - I41*sin(2*q3) + (lf**2*m4*sin(2*q3))/4 + lf*lo2*m4*sin(q3) + lf*lo4*m4*sin(q3)),                                                                                                                                                         I41*dq2*sin(2*q3) - I43*dq2*sin(2*q3) - I41*dq1*cos(q2) - I42*dq1*cos(q2) + I43*dq1*cos(q2) + 2*I41*dq1*cos(q2)*cos(q3)**2 - 2*I43*dq1*cos(q2)*cos(q3)**2 - (dq2*lf**2*m4*sin(2*q3))/4 - (dq1*lf**2*m4*cos(q2)*cos(q3)**2)/2 + (dq3*lf*m4*wf*cos(q3))/2 - dq2*lf*lo2*m4*sin(q3) - dq2*lf*lo4*m4*sin(q3) - dq1*lf*lo2*m4*cos(q2)*cos(q3) - dq1*lf*lo4*m4*cos(q2)*cos(q3) + (dq1*lf*m4*wf*cos(q3)*sin(q2))/2],
[                                                                                                                                                                                                                                                                                                                                                                   dq2*(I42*cos(q2) + (lf**2*m4*cos(q2))/4 - I41*cos(q2)*(2*cos(q3)**2 - 1) + I43*cos(q2)*(2*cos(q3)**2 - 1) + (lf**2*m4*cos(q2)*(2*cos(q3)**2 - 1))/4 + lf*lo2*m4*cos(q2)*cos(q3) + lf*lo4*m4*cos(q2)*cos(q3) - (lf*m4*wf*cos(q3)*sin(q2))/2) + dq1*(lf*lo3*m4*cos(q3) + lf*lo2*m4*sin(q3) + lf*lo4*m4*sin(q3) + 2*I41*cos(q2)**2*cos(q3)*sin(q3) - 2*I43*cos(q2)**2*cos(q3)*sin(q3) + l2*lf*m4*sin(q2)*sin(q3) - (lf**2*m4*cos(q2)**2*cos(q3)*sin(q3))/2 - lf*lo2*m4*cos(q2)**2*sin(q3) - lf*lo4*m4*cos(q2)**2*sin(q3) + (lf*m4*wf*cos(q2)*sin(q2)*sin(q3))/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              dq2*(2*I43*cos(q3)*sin(q3) - 2*I41*cos(q3)*sin(q3) + (lf**2*m4*cos(q3)*sin(q3))/2 + lf*lo2*m4*sin(q3) + lf*lo4*m4*sin(q3)) + dq1*(I42*cos(q2) + (lf**2*m4*cos(q2))/4 - I41*cos(q2)*(2*cos(q3)**2 - 1) + I43*cos(q2)*(2*cos(q3)**2 - 1) + (lf**2*m4*cos(q2)*(2*cos(q3)**2 - 1))/4 + lf*lo2*m4*cos(q2)*cos(q3) + lf*lo4*m4*cos(q2)*cos(q3) - (lf*m4*wf*cos(q3)*sin(q2))/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0]])

    G1 = np.array([gr*m4*(l2*cos(q1) + lo3*sin(q1) + (wf*cos(q1)*cos(q2))/2 + lo2*cos(q1)*sin(q2) + lo4*cos(q1)*sin(q2) - (lf*sin(q1)*sin(q3))/2 + (lf*cos(q1)*cos(q3)*sin(q2))/2) + gr*m3*(l2*cos(q1) + lo3*sin(q1) + lo2*cos(q1)*sin(q2)) + gr*l2*m2*cos(q1),
                                                                                                                            (gr*sin(q1)*(2*lo2*m3*cos(q2) + 2*lo2*m4*cos(q2) + 2*lo4*m4*cos(q2) - m4*wf*sin(q2) + lf*m4*cos(q2)*cos(q3)))/2,
                                                                                                                                                                                   (gr*lf*m4*(cos(q1)*cos(q3) - sin(q1)*sin(q2)*sin(q3)))/2])


    M2 = np.array([[I21 + I32 + I42 + l2**2*m2 + l2**2*m3 + l2**2*m4 + (lf**2*m4)/4 + lo2**2*m3 + lo2**2*m4 + lo3**2*m3 + lo3**2*m4 + lo4**2*m4 + I31*cos(q5)**2 - I32*cos(q5)**2 - I42*cos(q5)**2 + I43*cos(q5)**2 + I41*cos(q5)**2*cos(q6)**2 - I43*cos(q5)**2*cos(q6)**2 + 2*lo2*lo4*m4 - lo2**2*m3*cos(q5)**2 - lo2**2*m4*cos(q5)**2 - lo4**2*m4*cos(q5)**2 + (m4*wf**2*cos(q5)**2)/4 - (lf**2*m4*cos(q5)**2*cos(q6)**2)/4 + lf*lo2*m4*cos(q6) + lf*lo4*m4*cos(q6) + l2*m4*wf*cos(q5) - 2*l2*lo2*m3*sin(q5) - 2*l2*lo2*m4*sin(q5) - 2*l2*lo4*m4*sin(q5) + lf*lo3*m4*sin(q6) - 2*lo2*lo4*m4*cos(q5)**2 - (lo2*m4*wf*sin(2*q5))/2 - (lo4*m4*wf*sin(2*q5))/2 - l2*lf*m4*cos(q6)*sin(q5) - lf*lo2*m4*cos(q5)**2*cos(q6) - lf*lo4*m4*cos(q5)**2*cos(q6) - (lf*m4*wf*cos(q5)*cos(q6)*sin(q5))/2, (I43*sin(2*q6)*cos(q5))/2 - (I41*sin(2*q6)*cos(q5))/2 + lo2*lo3*m3*cos(q5) + lo2*lo3*m4*cos(q5) + lo3*lo4*m4*cos(q5) + (lo3*m4*wf*sin(q5))/2 + (lf**2*m4*sin(2*q6)*cos(q5))/8 + (lf*lo3*m4*cos(q5)*cos(q6))/2 + (lf*lo2*m4*cos(q5)*sin(q6))/2 + (lf*lo4*m4*cos(q5)*sin(q6))/2 + (lf*m4*wf*sin(q5)*sin(q6))/4, (l2*lf*m4*cos(q6))/2 - (lf**2*m4*sin(q5))/4 - I42*sin(q5) + (lf*m4*wf*cos(q5)*cos(q6))/4 - (lf*lo2*m4*cos(q6)*sin(q5))/2 - (lf*lo4*m4*cos(q6)*sin(q5))/2 - (lf*lo3*m4*sin(q5)*sin(q6))/2],
[                                                                                                                                                                                                                                                                                                                                                                                                                               (I43*sin(2*q6)*cos(q5))/2 - (I41*sin(2*q6)*cos(q5))/2 + lo2*lo3*m3*cos(q5) + lo2*lo3*m4*cos(q5) + lo3*lo4*m4*cos(q5) + (lo3*m4*wf*sin(q5))/2 + (lf**2*m4*sin(2*q6)*cos(q5))/8 + (lf*lo3*m4*cos(q5)*cos(q6))/2 + (lf*lo2*m4*cos(q5)*sin(q6))/2 + (lf*lo4*m4*cos(q5)*sin(q6))/2 + (lf*m4*wf*sin(q5)*sin(q6))/4,                                                                                                                                     I33 + I41 + lo2**2*m3 + lo2**2*m4 + lo4**2*m4 + (m4*wf**2)/4 - I41*cos(q6)**2 + I43*cos(q6)**2 + 2*lo2*lo4*m4 + (lf**2*m4*cos(q6)**2)/4 + lf*lo2*m4*cos(q6) + lf*lo4*m4*cos(q6),                                                                                                                                                                   -(lf*m4*wf*sin(q6))/4],
[                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   (l2*lf*m4*cos(q6))/2 - (lf**2*m4*sin(q5))/4 - I42*sin(q5) + (lf*m4*wf*cos(q5)*cos(q6))/4 - (lf*lo2*m4*cos(q6)*sin(q5))/2 - (lf*lo4*m4*cos(q6)*sin(q5))/2 - (lf*lo3*m4*sin(q5)*sin(q6))/2,                                                                                                                                                                                                                                                                                       -(lf*m4*wf*sin(q6))/4,                                                                                                                                                                       (m4*lf**2)/4 + I42]])

    C2 = np.array([[dq6*(lf*lo3*m4*cos(q6) - lf*lo2*m4*sin(q6) - lf*lo4*m4*sin(q6) - 2*I41*cos(q5)**2*cos(q6)*sin(q6) + 2*I43*cos(q5)**2*cos(q6)*sin(q6) + l2*lf*m4*sin(q5)*sin(q6) + (lf**2*m4*cos(q5)**2*cos(q6)*sin(q6))/2 + lf*lo2*m4*cos(q5)**2*sin(q6) + lf*lo4*m4*cos(q5)**2*sin(q6) + (lf*m4*wf*cos(q5)*sin(q5)*sin(q6))/2) - dq5*(I31*sin(2*q5) - I32*sin(2*q5) - I42*sin(2*q5) + I43*sin(2*q5) - lo2**2*m3*sin(2*q5) - lo2**2*m4*sin(2*q5) - lo4**2*m4*sin(2*q5) + (m4*wf**2*sin(2*q5))/4 + 2*l2*lo2*m3*cos(q5) + 2*l2*lo2*m4*cos(q5) + 2*l2*lo4*m4*cos(q5) + l2*m4*wf*sin(q5) + 2*I41*cos(q5)*cos(q6)**2*sin(q5) - 2*I43*cos(q5)*cos(q6)**2*sin(q5) + lo2*m4*wf*cos(2*q5) + lo4*m4*wf*cos(2*q5) - 2*lo2*lo4*m4*sin(2*q5) + l2*lf*m4*cos(q5)*cos(q6) - (lf**2*m4*cos(q5)*cos(q6)**2*sin(q5))/2 + (lf*m4*wf*cos(q5)**2*cos(q6))/2 - (lf*m4*wf*cos(q6)*sin(q5)**2)/2 - 2*lf*lo2*m4*cos(q5)*cos(q6)*sin(q5) - 2*lf*lo4*m4*cos(q5)*cos(q6)*sin(q5)), I32*dq4*sin(2*q5) - I31*dq4*sin(2*q5) + I42*dq4*sin(2*q5) - I43*dq4*sin(2*q5) - I42*dq6*cos(q5) - I41*dq6*cos(2*q6)*cos(q5) + I43*dq6*cos(2*q6)*cos(q5) + I41*dq5*sin(2*q6)*sin(q5) - I43*dq5*sin(2*q6)*sin(q5) + dq4*lo2**2*m3*sin(2*q5) + dq4*lo2**2*m4*sin(2*q5) + dq4*lo4**2*m4*sin(2*q5) - (dq4*m4*wf**2*sin(2*q5))/4 - (dq6*lf**2*m4*cos(q5))/4 + (dq6*lf**2*m4*cos(2*q6)*cos(q5))/4 - (dq5*lf**2*m4*sin(2*q6)*sin(q5))/4 - dq4*lo2*m4*wf*cos(2*q5) - dq4*lo4*m4*wf*cos(2*q5) + 2*dq4*lo2*lo4*m4*sin(2*q5) - 2*dq4*l2*lo2*m3*cos(q5) - 2*dq4*l2*lo2*m4*cos(q5) - 2*dq4*l2*lo4*m4*cos(q5) + dq5*lo3*m4*wf*cos(q5) - 2*dq5*lo2*lo3*m3*sin(q5) - 2*dq5*lo2*lo3*m4*sin(q5) - 2*dq5*lo3*lo4*m4*sin(q5) - dq4*l2*m4*wf*sin(q5) - 2*I41*dq4*cos(q5)*cos(q6)**2*sin(q5) + 2*I43*dq4*cos(q5)*cos(q6)**2*sin(q5) - (dq4*lf*m4*wf*cos(q5)**2*cos(q6))/2 + (dq4*lf*m4*wf*cos(q6)*sin(q5)**2)/2 - dq4*l2*lf*m4*cos(q5)*cos(q6) - dq5*lf*lo3*m4*cos(q6)*sin(q5) - dq6*lf*lo3*m4*cos(q5)*sin(q6) + (dq5*lf*m4*wf*cos(q5)*sin(q6))/2 - dq5*lf*lo2*m4*sin(q5)*sin(q6) - dq5*lf*lo4*m4*sin(q5)*sin(q6) + (dq4*lf**2*m4*cos(q5)*cos(q6)**2*sin(q5))/2 + 2*dq4*lf*lo2*m4*cos(q5)*cos(q6)*sin(q5) + 2*dq4*lf*lo4*m4*cos(q5)*cos(q6)*sin(q5), dq4*(lf*lo3*m4*cos(q6) - lf*lo2*m4*sin(q6) - lf*lo4*m4*sin(q6) - 2*I41*cos(q5)**2*cos(q6)*sin(q6) + 2*I43*cos(q5)**2*cos(q6)*sin(q6) + l2*lf*m4*sin(q5)*sin(q6) + (lf**2*m4*cos(q5)**2*cos(q6)*sin(q6))/2 + lf*lo2*m4*cos(q5)**2*sin(q6) + lf*lo4*m4*cos(q5)**2*sin(q6) + (lf*m4*wf*cos(q5)*sin(q5)*sin(q6))/2) - (dq5*cos(q5)*(2*I41 + 2*I42 - 2*I43 - 4*I41*sin(q6)**2 + 4*I43*sin(q6)**2 + lf**2*m4*sin(q6)**2 + 2*lf*lo3*m4*sin(q6)))/2 - (dq6*lf*m4*(2*l2*sin(q6) + 2*lo3*cos(q6)*sin(q5) + wf*cos(q5)*sin(q6) - 2*lo2*sin(q5)*sin(q6) - 2*lo4*sin(q5)*sin(q6)))/2],
[                                                                           (dq6*(2*I41*cos(q5) + 2*I42*cos(q5) - 2*I43*cos(q5) - 4*I41*cos(q5)*cos(q6)**2 + 4*I43*cos(q5)*cos(q6)**2 + lf**2*m4*cos(q5)*cos(q6)**2 + 2*lf*lo2*m4*cos(q5)*cos(q6) + 2*lf*lo4*m4*cos(q5)*cos(q6) + lf*m4*wf*cos(q6)*sin(q5)))/2 + dq4*(I31*sin(2*q5) - I32*sin(2*q5) - I42*sin(2*q5) + I43*sin(2*q5) - lo2**2*m3*sin(2*q5) - lo2**2*m4*sin(2*q5) - lo4**2*m4*sin(2*q5) + (m4*wf**2*sin(2*q5))/4 + 2*l2*lo2*m3*cos(q5) + 2*l2*lo2*m4*cos(q5) + 2*l2*lo4*m4*cos(q5) + l2*m4*wf*sin(q5) + 2*I41*cos(q5)*cos(q6)**2*sin(q5) - 2*I43*cos(q5)*cos(q6)**2*sin(q5) + lo2*m4*wf*cos(2*q5) + lo4*m4*wf*cos(2*q5) - 2*lo2*lo4*m4*sin(2*q5) + l2*lf*m4*cos(q5)*cos(q6) - (lf**2*m4*cos(q5)*cos(q6)**2*sin(q5))/2 + (lf*m4*wf*cos(q5)**2*cos(q6))/2 - (lf*m4*wf*cos(q6)*sin(q5)**2)/2 - 2*lf*lo2*m4*cos(q5)*cos(q6)*sin(q5) - 2*lf*lo4*m4*cos(q5)*cos(q6)*sin(q5)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            -dq6*(I43*sin(2*q6) - I41*sin(2*q6) + (lf**2*m4*sin(2*q6))/4 + lf*lo2*m4*sin(q6) + lf*lo4*m4*sin(q6)),                                                                                                                                                         I41*dq5*sin(2*q6) - I43*dq5*sin(2*q6) + I41*dq4*cos(q5) + I42*dq4*cos(q5) - I43*dq4*cos(q5) - 2*I41*dq4*cos(q5)*cos(q6)**2 + 2*I43*dq4*cos(q5)*cos(q6)**2 - (dq5*lf**2*m4*sin(2*q6))/4 + (dq4*lf**2*m4*cos(q5)*cos(q6)**2)/2 - (dq6*lf*m4*wf*cos(q6))/2 - dq5*lf*lo2*m4*sin(q6) - dq5*lf*lo4*m4*sin(q6) + dq4*lf*lo2*m4*cos(q5)*cos(q6) + dq4*lf*lo4*m4*cos(q5)*cos(q6) + (dq4*lf*m4*wf*cos(q6)*sin(q5))/2],
[                                                                                                                                                                                                                                                                                                                                                                 - dq5*(I42*cos(q5) + (lf**2*m4*cos(q5))/4 - I41*cos(q5)*(2*cos(q6)**2 - 1) + I43*cos(q5)*(2*cos(q6)**2 - 1) + (lf**2*m4*cos(q5)*(2*cos(q6)**2 - 1))/4 + lf*lo2*m4*cos(q5)*cos(q6) + lf*lo4*m4*cos(q5)*cos(q6) + (lf*m4*wf*cos(q6)*sin(q5))/2) - dq4*(lf*lo3*m4*cos(q6) - lf*lo2*m4*sin(q6) - lf*lo4*m4*sin(q6) - 2*I41*cos(q5)**2*cos(q6)*sin(q6) + 2*I43*cos(q5)**2*cos(q6)*sin(q6) + l2*lf*m4*sin(q5)*sin(q6) + (lf**2*m4*cos(q5)**2*cos(q6)*sin(q6))/2 + lf*lo2*m4*cos(q5)**2*sin(q6) + lf*lo4*m4*cos(q5)**2*sin(q6) + (lf*m4*wf*cos(q5)*sin(q5)*sin(q6))/2),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            dq5*(I43*sin(2*q6) - I41*sin(2*q6) + (lf**2*m4*sin(2*q6))/4 + lf*lo2*m4*sin(q6) + lf*lo4*m4*sin(q6)) - (dq4*(2*I41*cos(q5) + 2*I42*cos(q5) - 2*I43*cos(q5) - 4*I41*cos(q5)*cos(q6)**2 + 4*I43*cos(q5)*cos(q6)**2 + lf**2*m4*cos(q5)*cos(q6)**2 + 2*lf*lo2*m4*cos(q5)*cos(q6) + 2*lf*lo4*m4*cos(q5)*cos(q6) + lf*m4*wf*cos(q6)*sin(q5)))/2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0]])
    
    G2 = np.array([gr*m4*(lo3*sin(q4) - l2*cos(q4) - (wf*cos(q4)*cos(q5))/2 + lo2*cos(q4)*sin(q5) + lo4*cos(q4)*sin(q5) + (lf*sin(q4)*sin(q6))/2 + (lf*cos(q4)*cos(q6)*sin(q5))/2) + gr*m3*(lo3*sin(q4) - l2*cos(q4) + lo2*cos(q4)*sin(q5)) - gr*l2*m2*cos(q4),
                                                                                                                            (gr*sin(q4)*(2*lo2*m3*cos(q5) + 2*lo2*m4*cos(q5) + 2*lo4*m4*cos(q5) + m4*wf*sin(q5) + lf*m4*cos(q5)*cos(q6)))/2,
                                                                                                                                                                                  -(gr*lf*m4*(cos(q4)*cos(q6) + sin(q4)*sin(q5)*sin(q6)))/2])
    
    M = block_diag(M1, M2)
    C = block_diag(C1, C2)
    G = np.hstack((G1, G2))
    return M, C, G